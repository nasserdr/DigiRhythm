---
title: "Computing the DFC/HP and manipulating the functions returned objects"
author: "Hassan Roland Nasser"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Computing the DFC/HP and manipulating the functions returned objects}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>", fig.width = 7
)
```

```{r setup}
library(digiRhythm)
data <- digiRhythm::df625 
data <- resample_dgm(data, 15)
data <- remove_activity_outliers(data)
activity = names(data)[3]
head(activity)
```

# Degree of functional Coupling and harmonic power
The degree of functional coupling and the harmonic power could be computed using the dfc function as shown below.

The DFC algorithm is a bit complicated. It's, therefore, needed that we clarify few points about some computing considerations and also about the arguments of the function itself:

- The recommended sampling period is between 15 and 30 min.
- The DFC and HP are computed based on 7 days of data. If the data contains 8 days of data, then we will only have two DFC and HP values. The first value is computed based on Day1-Day7 and the second value is computed based on Day2-Day8. Therefore, the number of DFC and HP data points would be exactly equal: D - 6 (where D is the total number of days).
- Since the DFC is based on the Lomb-Scargle Periodogram, then the DFC allows having complete missing days in the dataset. In order to compute a DFC for each subset of data, one needs to split the data into two different subsets beforehand.

The below plot shows the DFC and HP in the same graph. Both variables are percentages.

```{r dfc_hp}
my_dfc <- dfc(data, activity = activity,  plot = FALSE, verbose = FALSE)
print(my_dfc)
```
# Accessing output data and changing the plots using DigiRhythm

The DFC function returns a object of type ggplot:

```{r type_dfc}
class(my_dfc)
```

As shown, the class is gg or ggplot. This allows the user to:
- Access the data of DFC or HP directly from the returned object.
- Add aesthetics layer to the plot as needed.

To access the data, one has to use the *data* component of the DFC object. We illustrate this in the below code:

```{r return_data}
head(my_dfc$data)
```
As shown, we can access a dataframe where the first comlumn is the date and the second two columns are the DFC and HP respectively. This will allow the users to be able to use the returned data in further studies such as modelling.

Users can also change the aesthetics of the plot directly if they wish. This is possible by adding a ggplot layer to the returned DFC object. For instance, this is the original plot returned by the DFC:

```{r og_plot}
print(my_dfc)
```
As an illustrative example, in the below code we add a new aesthetic layer to the ggplot object. This layer does nothing but increasing the width of the x-axis. Users can add any other aesthetic layer as they wish; the immagination is the only limit.

```{r change_aes}
library(ggplot2)
new_plot <- my_dfc + 
  theme(axis.line.x.bottom=element_line(size=2))
print(new_plot)
```
